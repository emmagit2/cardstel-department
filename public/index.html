<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Professional Department Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
<!-- Bootstrap Icons CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body {
        background-color: #f4f6f9;
        font-family: 'Segoe UI', sans-serif;
        font-size: 0.9rem;
        overflow-x: hidden;
    }
    .sidebar {
        background: linear-gradient(180deg, #4b6cb7, #182848);
        color: white;
        height: 100vh;
        transition: all 0.3s ease;
        position: fixed;
        left: 0;
        top: 0;
        overflow-y: auto;
        z-index: 2000;
        width: 65px;
        display: flex;
        flex-direction: column;
    }
    .sidebar.expanded { width: 200px; }
    .logo-container {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px;
        order: 0;
    }
    .logo-container img { width: 35px; height: 35px; border-radius: 6px; }
    .logo-container span { font-weight: bold; font-size: 0.85rem; white-space: nowrap; }
    .sidebar:not(.expanded) .logo-container { order: 99; margin-top: auto; padding-bottom: 15px; }
    .sidebar:not(.expanded) .logo-container span { display: none; }
    .toggle-btn {
        background: none;
        border: none;
        color: white;
        font-size: 1rem;
        padding: 8px 20px;
        display: flex;
        align-items: center;
        gap: 8px;
        width: 100%;
        text-align: left;
        margin-bottom: 15px;
    }
    .toggle-btn span { font-size: 0.85rem; }
    .sidebar:not(.expanded) .toggle-btn span { display: none; }
    .nav-link {
        color: #d1d5db;
        padding: 8px 10px;
        display: flex;
        align-items: center;
        transition: background 0.2s;
        font-size: 0.85rem;
    }
    .nav-link:hover { background: rgba(255, 255, 255, 0.1); color: white; }
    .nav-link i {
        font-size: 0.9rem;
        background: white;
        color: #182848;
        border-radius: 50%;
        padding: 6px;
        margin-right: 10px;
        border: 1px solid white;
    }
    .sidebar:not(.expanded) .nav-link span { display: none; }
    .sidebar:not(.expanded) .nav-link i { margin-right: 0; }
    .content { margin-left: 65px; transition: margin-left 0.3s; }
    .sidebar.expanded ~ .content { margin-left: 200px; }
    .top-bar {
        background: white;
        padding: 10px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid #ddd;
    }
    .user-menu {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
    }
    .user-menu img { width: 35px; height: 35px; border-radius: 50%; }
    @media(max-width: 768px) {
        .sidebar { left: -200px; width: 200px; box-shadow: 2px 0 8px rgba(0,0,0,0.2); }
        .sidebar.expanded { left: 0; }
        .top-bar { justify-content: flex-start; gap: 10px; }
        .hamburger-btn {
            background: none; border: none; font-size: 1.2rem; color: #182848;
        }
        .content { margin-left: 0 !important; }
        .overlay {
            display: none;
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            z-index: 1999;
        }
        .overlay.active { display: block; }
    }
     .gradient-card {
    border-radius: 1rem;
    padding: 1rem;
    transition: transform 0.2s;
  }
  .gradient-card:hover {
    transform: translateY(-5px);
  }
  .bg-gradient-primary {
    background: linear-gradient(135deg,#0d6efd,#85c1ff);
  }


  .icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display:flex;
    justify-content:center;
    align-items:center;
  }

  .bg-gradient-primary { background: linear-gradient(135deg,#0d6efd,#85c1ff);}
  .bg-gradient-success { background: linear-gradient(135deg,#28a745,#85e085);}
  .bg-gradient-warning { background: linear-gradient(135deg,#ffc107,#ffe085);}
  .bg-gradient-danger { background: linear-gradient(135deg,#dc3545,#ff7f7f);}
  .summary-card, .filter-box, .card, .table-responsive {
    transition: transform 0.2s;
  }
  .summary-card:hover, .filter-box:hover, .card:hover, .table-responsive:hover {
    transform: translateY(-5px);
  }
/* ===== Modern Deep Orange Theme with Elegant Table Titles ===== */
:root {
  --deep-orange: #e65100;
  --light-orange: #ff9800;
  --orange-gradient: linear-gradient(135deg, #ff6f00, #e65100, #bf360c);
  --dark-gray: #212121;
  --soft-gray: #f5f5f5;
}

/* ===== Main Panel ===== */
#jobManagementPanel {
  background: linear-gradient(to bottom right, #ffffff, #f9f9f9);
  border: 1px solid #eee;
  border-radius: 18px;
  padding: 25px;
  box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
  animation: fadeIn 0.9s ease;
}

/* ===== Main Header Card ===== */
.job-header-card {
  background: var(--orange-gradient);
  border-radius: 15px;
  color: #fff;
  padding: 25px 20px;
  margin-bottom: 25px;
  box-shadow: 0 4px 20px rgba(230, 81, 0, 0.25);
  animation: fadeSlide 1s ease;
  position: relative;
  overflow: hidden;
}

.job-header-card::after {
  content: "";
  position: absolute;
  top: 0;
  right: -50px;
  width: 180px;
  height: 100%;
  background: rgba(255, 255, 255, 0.15);
  transform: skew(-25deg);
}

.job-header-card h3 {
  font-weight: 700;
  font-size: 1.8rem;
  letter-spacing: 0.8px;
}

.job-header-card small {
  opacity: 0.9;
  font-size: 0.9rem;
}

/* ===== Filter Section ===== */
#jobManagementPanel .card {
  border: none;
  border-radius: 15px;
  background: linear-gradient(to right, #fff, #fff9f4);
  box-shadow: 0 3px 10px rgba(255, 111, 0, 0.15);
  transition: 0.3s ease;
}

#jobManagementPanel .card:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 18px rgba(255, 111, 0, 0.25);
}

#jobManagementPanel .form-label {
  color: var(--deep-orange);
  font-weight: 600;
}

#jobManagementPanel .form-control,
#jobManagementPanel .form-select {
  border: 1px solid #ddd;
  border-radius: 10px;
  transition: all 0.3s;
}

#jobManagementPanel .form-control:focus,
#jobManagementPanel .form-select:focus {
  border-color: var(--light-orange);
  box-shadow: 0 0 0 0.2rem rgba(255, 152, 0, 0.25);
}

/* ===== Filter Buttons ===== */
#applyFilters {
  background: var(--orange-gradient);
  border: none;
  color: #fff;
  border-radius: 10px;
  padding: 8px 15px;
  transition: 0.3s;
}
#applyFilters:hover {
  transform: scale(1.05);
  box-shadow: 0 3px 10px rgba(255, 111, 0, 0.3);
}

#resetFilters {
  background: #9e9e9e;
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 8px 15px;
  transition: 0.3s;
}
#resetFilters:hover {
  background: #616161;
}

/* ===== Section Titles for Tables ===== */
.table-title {
  background: var(--orange-gradient);
  color: #fff;
  font-weight: 700;
  text-transform: uppercase;
  font-size: 0.9rem;
  letter-spacing: 0.8px;
  border-radius: 10px 10px 0 0;
  padding: 10px 15px;
  box-shadow: 0 3px 10px rgba(230, 81, 0, 0.25);
  display: flex;
  align-items: center;
  justify-content: space-between;
  animation: fadeSlide 1.2s ease;
}

/* Subtle glowing animation for table titles */
.table-title span {
  animation: glowText 3s infinite ease-in-out;
}

@keyframes glowText {
  0%, 100% { text-shadow: 0 0 5px rgba(255,255,255,0.2); }
  50% { text-shadow: 0 0 15px rgba(255,255,255,0.6); }
}

/* ===== Table Styling ===== */
.table-wrapper {
  overflow-x: auto;
  background-color: var(--soft-gray);
  border-radius: 0 0 12px 12px;
  padding: 10px;
  box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
}

#jobManagementPanel table {
  min-width: 900px;
  border-collapse: separate;
  width: 100%;
  border-spacing: 0;
  border-radius: 10px;
  overflow: hidden;
}

/* Animated dark gradient header */
#jobManagementPanel thead {
  background: linear-gradient(135deg, #424242, #616161, #757575);
  color: #fff;
  animation: headerGradient 6s infinite alternate ease-in-out;
}

#jobManagementPanel th {
  font-size: 0.8rem;
  font-weight: 600;
  padding: 12px;
  text-transform: uppercase;
  text-align: center;
  white-space: nowrap;
}

#jobManagementPanel tbody tr {
  transition: 0.25s ease;
}

#jobManagementPanel tbody tr:hover {
  background-color: rgba(255, 111, 0, 0.08);
  transform: scale(1.01);
}

/* ===== Animations ===== */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(25px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeSlide {
  from { opacity: 0; transform: translateX(-25px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes headerGradient {
  0% { background: linear-gradient(135deg, #424242, #616161); }
  50% { background: linear-gradient(135deg, #757575, #424242); }
  100% { background: linear-gradient(135deg, #616161, #212121); }
}

/* ===== Table Section Titles: Magical & Modern ===== */
.table-title {
  background: var(--orange-gradient); /* Deep orange gradient */
  color: #fff;
  font-weight: 600;
  font-size: 0.8rem; /* slightly smaller for elegance */
  text-transform: uppercase;
  letter-spacing: 0.6px;
  border-radius: 8px 8px 0 0;
  padding: 8px 12px;
  display: flex;
  align-items: center;
  gap: 8px; /* space between icon and text */
  box-shadow: 0 3px 10px rgba(230, 81, 0, 0.25);
  justify-content: flex-start;
  animation: fadeSlide 1.2s ease;
}

/* Icon next to the title */
.table-title i {
  font-size: 1rem;
  color: #fff;
  animation: glowIcon 2.5s infinite alternate ease-in-out;
}

/* Glowing effect for text */
.table-title span {
  display: inline-block;
  animation: glowText 3s infinite ease-in-out;
}

/* Subtle glowing animation for text */
@keyframes glowText {
  0%, 100% { text-shadow: 0 0 3px rgba(255,255,255,0.2); }
  50% { text-shadow: 0 0 10px rgba(255,255,255,0.6); }
}

/* Subtle glowing animation for icon */
@keyframes glowIcon {
  0%, 100% { text-shadow: 0 0 2px rgba(255,255,255,0.2); }
  50% { text-shadow: 0 0 8px rgba(255,255,255,0.8); }
}

  /* Overall Section Header */
  .overall-summary h2 {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 1.6rem;
    color: #222;
    font-weight: 700;
  }

  .overall-summary .header-icon {
    background: linear-gradient(135deg, #ff6a00, #ff4500);
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(255, 90, 0, 0.4);
  }

  /* Summary Cards */
  .summary-card {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    border-radius: 16px;
    background: #fff;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    transition: transform 0.3s, box-shadow 0.3s;
  }

  .summary-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 25px rgba(255, 100, 0, 0.2);
  }

  .icon-gradient {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #ff6a00, #ff4500);
    border-radius: 50%;
    color: #fff;
    font-size: 1.5rem;
    box-shadow: 0 4px 12px rgba(255,90,0,0.3);
  }

  .summary-card h6 {
    margin: 0;
    font-size: 0.875rem;
    color: #666;
  }

  .summary-card h3 {
    margin: 0;
    font-weight: 700;
    color: #222;
    font-size: 1.3rem;
  }

.overall-summary h2 .header-icon {
  width: 45px;
  height: 45px;
  background: linear-gradient(135deg, #ff7a00, #ff4500);
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}

/* Subtitle */
.overall-summary h2 + p {
  margin-left: 60px; /* aligns subtitle with text, not icon */
  color: #6c757d;
  font-size: 0.95rem;
}


/* Filter Box Items */
.filter-box {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
    justify-content: center;

  align-items: center;
}

/* Each filter item */
.filter-item {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  margin-left: 2.1rem;
}

/* Align labels nicely on desktop */
@media (min-width: 576px) {
  .filter-item {
    flex-direction: row;
    align-items: center;
  }
}

/* Modern rounded inputs */
.filter-box select,
.filter-box input {
  border-radius: 50px !important;
  padding: 0.375rem 0.75rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  border: 1px solid #ddd;
  transition: all 0.2s ease;
}

.filter-box select:focus,
.filter-box input:focus {
  border-color: #ff4500;
  box-shadow: 0 0 6px rgba(255,69,0,0.3);
  outline: none;
}

/* Gradient Apply Button */
.btn-gradient-orange {
  background: linear-gradient(135deg, #ff8c00, #ff4500);
  color: #fff;
  border: none;
  transition: all 0.3s ease;
}
.btn-gradient-orange:hover {
  background: linear-gradient(135deg, #ff7000, #ff3a00);
  box-shadow: 0 4px 10px rgba(255,69,0,0.3);
}

/* Card Header Gradient */
.card-header.bg-gradient-orange {
  background: linear-gradient(135deg, black, black);
  font-size: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  border-bottom: none;
}

/* Card Body */
.card-body {
  background-color: #f9f9f9;
}

/* Optional: subtle shadow for canvas container */
.card-body canvas {
  border-radius: 0.5rem;
}


 /* Cards */
  #bankSections .card {
    border: none;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    transition: transform 0.3s, box-shadow 0.3s;
  }
  #bankSections .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 25px rgba(255, 90, 0, 0.15);
  }

  /* Card Header */
  #customBankRecordsPanel .card-header {
    background: #000; /* black header */
    background: linear-gradient(135deg, #000, #222);
    color: #fff;
    font-weight: 600;
    font-size: 0.95rem;
    border-radius: 16px 16px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem 1rem;
  }

  /* Header buttons */
  #customBankRecordsPanel .card-header .btn {
    font-weight: 600;
    font-size: 0.8rem;
    border-radius: 6px;
    background: #222;
    color: #ff6a00;
    border: 1px solid #ff6a00;
    transition: 0.2s;
  }
  #customBankRecordsPanel .card-header .btn:hover {
    background: #ff6a00;
    color: #fff;
  }

  /* Filters */
  #customBankRecordsPanel .card-body .form-label {
    font-weight: 600;
    color: #666;
    font-size: 0.8rem;
  }
  #customBankRecordsPanel .form-select,
  #customBankRecordsPanel .form-control {
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    font-size: 0.85rem;
  }

  /* Apply button */
  #bankApply_custom {
    background: linear-gradient(135deg, #ff6a00, #ff4500);
    border: none;
  }
  #bankApply_custom:hover {
    background: linear-gradient(135deg, #ff4500, #ff6a00);
  }

  /* Table headers */
  #customBankRecordsPanel table thead,
  #bankSections table thead {
    background: #000; /* black header */
    color: #ff6a00;   /* deep orange touch */
    font-weight: 600;
    position: sticky;
    top: 0;
    z-index: 1;
  }

  /* Table styling */
  #bankSections table {
    border-collapse: separate;
    border-spacing: 0 6px;
    font-size: 0.875rem;
  }
  #bankSections table tbody tr {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.03);
  }
  #bankSections table td,
  #bankSections table th {
    vertical-align: middle;
    text-align: center;
    border: none;
    padding: 0.6rem 0.75rem;
  }

  /* Right panel export buttons */
  #bankSections .btn-outline-success {
    border-color: #ff6a00;
    color: #ff6a00;
  }
  #bankSections .btn-outline-success:hover {
    background: #ff6a00;
    color: #fff;
  }
  #bankSections .btn-outline-danger {
    border-color: #ff4500;
    color: #ff4500;
  }
  #bankSections .btn-outline-danger:hover {
    background: #ff4500;
    color: #fff;
  }
</style>
</head>
<body>

<!-- Overlay for Mobile -->
<div id="overlay" class="overlay" onclick="toggleSidebar()"></div>

<!-- Sidebar -->
<div id="sidebar" class="sidebar">
    <button class="toggle-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
        <span>Menu</span>
    </button>

    <nav class="nav flex-column flex-grow-1">
        <a href="#" class="nav-link" data-target="homePanel"><i class="fas fa-house"></i> <span>Home</span></a>

        <!-- Product Dropdown -->
        <div class="nav-item">
            <a href="#" class="nav-link" data-bs-toggle="collapse" data-bs-target="#productSubmenu" aria-expanded="false">
                <i class="fas fa-box"></i> <span>Production Management</span>
                <i class="fas fa-caret-down ms-auto"></i>
            </a>
         <div class="collapse" id="productSubmenu">
    <a href="#" class="nav-link ps-4" data-target="deviceUsagePanel">Device Usage</a>
    <a href="#" class="nav-link ps-4" data-target="personTeamPanel">Person Team</a>
      <a href="#" class="nav-link ps-4" data-target="jobManagementPanel">Job Management</a>
    <a href="#" class="nav-link ps-4" data-target="cardRecordsPanel">Card Records</a>
    <a href="#" class="nav-link ps-4" data-target="machineReportPanel">Machine Report</a>
    <!-- ✅ New Job Management Panel Link -->
  
</div>

        </div>
        <!-- Staff Management Dropdown -->
<div class="nav-item">
  <a href="#" class="nav-link" data-bs-toggle="collapse" data-bs-target="#staffSubmenu" aria-expanded="false">
    <i class="fas fa-users"></i> <span>Staff Management</span>
    <i class="fas fa-caret-down ms-auto"></i>
  </a>
  <div class="collapse" id="staffSubmenu">
    <a href="#" class="nav-link ps-4" data-target="staffListPanel">Manage Staff</a>
  </div>
</div>

    </nav>

    <div class="logo-container">
        <img src="https://via.placeholder.com/50" alt="Company Logo">
        <span>MyCompany</span>
    </div>
</div>

<!-- Main Content -->
<div class="content">
    <div class="top-bar">
        <button class="hamburger-btn d-md-none" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        <h6 class="m-0 d-none d-md-block">📊 Department Management Dashboard</h6>
        <div class="dropdown ms-auto">
            <div class="user-menu" data-bs-toggle="dropdown">
                <img src="https://via.placeholder.com/40" alt="User">
                <span>John Doe</span>
                <i class="fas fa-caret-down"></i>
            </div>
            <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="#">Profile</a></li>
                <li><a class="dropdown-item" href="#">Settings</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">Logout</a></li>
            </ul>
        </div>
    </div>

    <!-- Panels -->
    <div id="homePanel" class="p-3 department-panel">
        <h3>🏠 Home</h3>
        <p>Welcome to the Department Management Dashboard. Select a menu option to view details.</p>
    </div>

<div id="deviceUsagePanel" class="p-4 bg-light rounded-4 shadow-sm department-panel">

    <!-- Title Section -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h3 class="fw-bold mb-1"><i class="bi bi-bar-chart-line"></i> Device Usage</h3>
            <small class="text-muted">Monitor printing activity & analytics</small>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-primary btn-sm"><i class="bi bi-download"></i> Export PDF</button>
            <button class="btn btn-outline-success btn-sm"><i class="bi bi-file-earmark-spreadsheet"></i> Export Excel</button>
        </div>
    </div>
<!-- ================================
     TOTAL PRINTS SECTION
================================ -->
<!-- ================================>
<!-- ================================
     TOTAL PRINTS SECTION (Custom Query Panel)
================================ -->
<section class="total-prints-section container my-4">

  <!-- Device & Date Range Selector -->
  <div class="row g-3 mb-4">
    <!-- Device Selector -->
    <div class="col-md-3">
      <label for="totalPrintDevice" class="form-label fw-semibold">Select Device:</label>
      <select id="totalPrintDevice" class="form-select">
        <option value="">-- Select Device --</option>
        <!-- JS will populate options -->
      </select>
    </div>

    <!-- Start Date -->
    <div class="col-md-3">
      <label for="customStartDate" class="form-label fw-semibold">Start Date:</label>
      <input type="date" id="customStartDate" class="form-control">
    </div>

    <!-- End Date -->
    <div class="col-md-3">
      <label for="customEndDate" class="form-label fw-semibold">End Date:</label>
      <input type="date" id="customEndDate" class="form-control">
    </div>

    <!-- Run Button -->
    <div class="col-md-3 d-flex align-items-end">
      <button id="runCustomQuery" class="btn btn-primary w-100">Run</button>
    </div>
  </div>

  <!-- Side by Side: Total & Breakdown -->
  <div class="row g-3">
    <!-- Total Prints Card -->
    <div class="col-md-4">
      <div id="startCustomTotalCard" class="p-4 rounded shadow-sm text-center" style="background: linear-gradient(135deg, #f0f8ff, #d0e4ff);">
        <div class="text-muted mb-2">Total Prints (Custom)</div>
        <div id="startCustomTotalValue" class="fs-1 fw-bold text-primary">0</div>
      </div>
    </div>

    <!-- Divider Line -->
    <div class="col-md-1 d-none d-md-flex align-items-center justify-content-center">
      <div style="width: 1px; background-color: #dee2e6; height: 100%;"></div>
    </div>

    <!-- Daily Breakdown Panel -->
    <div class="col-md-7">
      <div id="startCustomRawData" class="p-3 rounded shadow-sm" style="background: #fff; font-family: monospace; font-size: 0.9rem; color: #333; overflow-x: auto; white-space: pre-wrap; word-break: break-word;">
        Select a device and date range to see daily breakdown...
      </div>
    </div>
  </div>

</section>



    <div class="row g-4">

        <!-- Left Panel: Filters + Chart -->
        <div class="col-lg-8">

            <!-- Filters Card -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body">
                    <div class="row g-3 align-items-end">

                        <!-- Device Select -->
                        <div class="col-md-6">
                            <label class="form-label fw-semibold" for="deviceSelect">Select Device</label>
                            <select class="form-select" id="deviceSelect">
                                <option value="">-- Select Device --</option>
                            </select>
                        </div>

                        <!-- Time Range -->
                        <div class="col-md-3">
                            <label class="form-label fw-semibold" for="timeRangeSelect">View By</label>
                            <select class="form-select" id="timeRangeSelect">
                                <option value="week">Week</option>
                                <option value="month">Month</option>
                            </select>
                        </div>

                        <!-- Date Picker -->
                        <div class="col-md-3">
                            <label class="form-label fw-semibold">Select Date</label>
                            <input type="week" class="form-control" id="weekPicker">
                            <input type="month" class="form-control" id="monthPicker" style="display:none;">
                        </div>

                    </div>
                </div>
            </div>

           <!-- Chart Card -->
<div class="card shadow-sm border-0">
  <div class="card-body">
    <!-- Title switches dynamically -->
    <h5 id="chartTitle" class="card-title mb-3 fw-semibold">Printing Trends</h5>
    <canvas id="deviceUsageChart" height="250"></canvas>
  </div>
</div>


        </div>

        <!-- Right Panel: Jobs Table & Search -->
        <div class="col-lg-4">

            <!-- Search Cards -->
            <div class="card shadow-sm border-0 mb-3">
                <div class="card-body">
                    <!-- Job Search -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold" for="jobSearch">Search Job ID</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="jobSearchs" placeholder="Enter Job ID">
                            <button class="btn btn-primary" id="jobSearchBtn"><i class="bi bi-search"></i></button>
                        </div>
                    </div>

                    <!-- Custom Date Search -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold" for="customDate">Custom Date</label>
                        <input type="date" class="form-control mb-2" id="customDate">
                        <button class="btn btn-info w-100" id="customDateSearchBtn"><i class="bi bi-calendar-event"></i> Search by Date</button>
                    </div>
                </div>
            </div>

            <!-- Jobs Table -->
            <div class="card shadow-sm border-0 mb-3">
                <div class="card-body">
                    <h5 class="card-title mb-3 fw-semibold">Recent Jobs</h5>
                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-sm table-striped align-middle table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Job ID</th>
                                    <th>Date & Time</th>
                                    <th>Range</th>
                                    <th>Total Prints</th>
                                    <th>Bank</th>
                                </tr>
                            </thead>
                            <tbody id="jobsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>

    </div>

 <div  class="p-4 bg-light rounded-4 shadow-sm mt-5">

    <!-- Title Section -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h3 class="fw-bold mb-1" id="tonerTitle" ><i class="bi bi-printer"></i> Toner Usage</h3>
            <small class="text-muted">Track toner install & replacement history</small>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-primary btn-sm" id="exportPdfBtn"><i class="bi bi-download"></i> Export PDF</button>
            <button class="btn btn-outline-success btn-sm" id="exportExcelBtn"><i class="bi bi-file-earmark-spreadsheet"></i> Export Excel</button>
        </div>
    </div>

    <!-- Filters -->
    <div class="row g-3 mb-4">
        <!-- Device Filter -->
        <div class="col-md-4">
            <label class="form-label fw-semibold" for="tonerDeviceSelect">Select Device</label>
            <select class="form-select" id="tonerDeviceSelect">
                <option value="">-- All Devices --</option>
            </select>
        </div>

        <!-- Toner Code Search -->
        <div class="col-md-4">
            <label class="form-label fw-semibold" for="tonerSearch">Search Toner Code</label>
            <div class="input-group">
                <input type="text" class="form-control" id="tonerSearch" placeholder="Enter toner code">
                <button class="btn btn-primary" id="tonerSearchBtn"><i class="bi bi-search"></i></button>
            </div>
        </div>

        <!-- Date Range Filter -->
        <div class="col-md-4">
            <label class="form-label fw-semibold" for="tonerDateRange">Custom Date</label>
            <input type="date" class="form-control mb-2" id="tonerDateRangeStart" placeholder="Start Date">
            <input type="date" class="form-control" id="tonerDateRangeEnd" placeholder="End Date">
            <button class="btn btn-info w-100 mt-2" id="tonerDateSearchBtn"><i class="bi bi-calendar-event"></i> Filter by Date</button>
        </div>
    </div>

    <!-- Toner Table -->
    <div class="card shadow-sm border-0">
        <div class="card-body">
            <h5 class="card-title mb-3 fw-semibold" >Toner History</h5>
            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                <table class="table table-sm table-striped align-middle table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Toner Code</th>
                            <th>Device</th>
                            <th>Install Date</th>
                            <th>Replace Date</th>
                            <th>Total Prints</th>
                        </tr>
                    </thead>
                    <tbody id="tonerTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

</div>


</div>


<!-- Person Team Panel -->
<div id="personTeamPanel" class="p-4 department-panel bg-white shadow-lg rounded-3" style="display:none;">

    <!-- Title -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold mb-0">👥 Perso Team</h3>
        <small class="text-muted">Track staff printing activity, jobs, and targets</small>
    </div>

    <!-- Staff Selection + Search -->
    <div class="row g-4 align-items-end mb-4">
        <!-- Select Staff -->
        <div class="col-md-4">
            <label class="form-label fw-semibold">Select Staff</label>
            <select id="staffSelect" class="form-select">
                <!-- Dynamic options inserted by JS -->
            </select>
        </div>

        <!-- Search Staff -->
        <!-- <div class="col-md-4">
            <label class="form-label fw-semibold">Search Staff</label>
            <div class="input-group">
                <input type="text" id="staffSearch" class="form-control" placeholder="Search staff...">
                <button class="btn btn-primary" id="staffSearchBtn">Search</button>
            </div>
        </div> -->

        <!-- Performance View -->
        <!-- <div class="col-md-4">
            <label class="form-label fw-semibold">Performance View</label>
            <select id="performanceView" class="form-select">
                <option value="weekly">Weekly</option>
                <option value="monthly" selected>Monthly</option>
            </select>
        </div> -->
    </div>

    <!-- Optional: Custom Date Filter -->
    <div class="row g-3 mb-4">
        <div class="col-md-6">
            <label class="form-label fw-semibold">Start Date</label>
            <input type="date" id="customDateStart" class="form-control">
        </div>
        <div class="col-md-6">
            <label class="form-label fw-semibold">End Date</label>
            <input type="date" id="customDateEnd" class="form-control">
        </div>
        <div class="col-md-12 mt-2">
            <button class="btn btn-secondary" id="customDateSearchBtnjob">Filter by Date</button>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="row g-4">
        <!-- LEFT: Job Table -->
        <div class="col-lg-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="fw-semibold">Job Records</h5>
                        <div class="input-group input-group-sm w-auto">
                            <input type="text" id="jobSearchjob" class="form-control" placeholder="Search Job ID">
                            <button class="btn btn-outline-primary" id="jobSearchBtnjob">Search</button>
                        </div>
                    </div>
                    <div class="table-responsive" style="max-height: 280px; overflow-y:auto;">
                        <table class="table table-sm table-striped align-middle" id="jobTable">
                            <thead class="table-light">
                                <tr>
                                    <th>Job ID</th>
                                    <th>Time</th>
                                    <th>Date</th>
                                    <th>Qty Printed</th>
                                    <th>Amount</th>
                                    <th>Range</th>
                                    <th>Printer Used</th>
                                </tr>
                            </thead>
                            <tbody id="staffJobsTableBody">
                                <!-- Dynamically filled via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT: Staff Performance Graph -->
        <div class="col-lg-6">
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body">
                    <h5 class="card-title mb-3 fw-semibold">📊 Staff Work Performance</h5>
                    <canvas id="staffJobChart" height="250"></canvas>
                </div>
            </div>

        </div>
    </div>

    <!-- Active Days & Target -->
   <!--  <div class="card shadow-sm border-0 mt-4">
        <div class="card-body">
            <h5 class="card-title mb-3 fw-semibold">📅 Active Days & Monthly Target</h5>
            <canvas id="activeDaysChart" height="200"></canvas>
            <div class="mt-3">
                <label class="form-label fw-semibold">Target Progress</label>
                <div class="progress">
                    <div class="progress-bar bg-success" id="targetProgressBar" style="width: 0%;">0% of Target Reached</div>
                </div>
            </div>
        </div>
    </div> -->

</div>
<div id="cardRecordsPanel" class="p-4 department-panel">

  <!-- ================== Overall Summary ================== -->
  <div class="overall-summary mb-5">
    <h2 class="fw-bold mb-1 d-flex align-items-center gap-3">
      <span class="header-icon d-flex align-items-center justify-content-center">
        <i class="bi bi-credit-card-2-front fs-3 text-white"></i>
      </span>
      Overall Card Printing Summary
    </h2>
    <p class="text-muted mb-4 fs-6">
      Track your card displacement, quantity, and what’s printed
    </p>

    <!-- Summary Cards -->
    <div class="row g-4">
      <div class="col-md-3">
        <div class="summary-card">
          <div class="icon-gradient"><i class="bi bi-card-text"></i></div>
          <div>
            <h6>Cards Today</h6>
            <h3 id="todayCount">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="summary-card">
          <div class="icon-gradient"><i class="bi bi-calendar-week"></i></div>
          <div>
            <h6>This Week</h6>
            <h3 id="weekCount">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="summary-card">
          <div class="icon-gradient"><i class="bi bi-calendar2-month"></i></div>
          <div>
            <h6>This Month</h6>
            <h3 id="monthCount">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="summary-card">
          <div class="icon-gradient"><i class="bi bi-bank"></i></div>
          <div>
            <h6>Top Bank</h6>
            <h3 id="topBank">N/A</h3>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ================== Filter Box for Overall Graph ================== -->
  <div class="filter-box shadow-sm rounded-4 p-3 mb-4 d-flex flex-wrap justify-content-start align-items-center gap-3 bg-white">
    <div class="filter-item d-flex flex-column flex-sm-row align-items-start align-items-sm-center gap-2">
      <label for="overallBankSelect" class="fw-semibold small text-muted mb-0">Bank</label>
      <select id="overallBankSelect" class="form-select form-select-sm shadow-sm rounded-pill">
        <option value="">All Banks</option>
      </select>
    </div>

    <div class="filter-item d-flex flex-column flex-sm-row align-items-start align-items-sm-center gap-2">
      <label for="overallFilterType" class="fw-semibold small text-muted mb-0">Filter Type</label>
      <select id="overallFilterType" class="form-select form-select-sm shadow-sm rounded-pill">
        <option value="week">Weekly</option>
        <option value="month">Monthly</option>
      </select>
    </div>

    <div class="filter-item d-flex flex-column flex-sm-row align-items-start align-items-sm-center gap-2" id="weekFilterBox">
      <label for="overallWeek" class="fw-semibold small text-muted mb-0">Select Week</label>
      <input id="overallWeek" type="week" class="form-control form-control-sm shadow-sm rounded-pill">
    </div>

    <div class="filter-item d-flex flex-column flex-sm-row align-items-start align-items-sm-center gap-2" id="monthFilterBox" style="display:none;">
      <label for="overallMonth" class="fw-semibold small text-muted mb-0">Select Month</label>
      <input id="overallMonth" type="month" class="form-control form-control-sm shadow-sm rounded-pill">
    </div>

    <button id="applyOverall" class="btn btn-gradient-orange px-4 py-2">
      <i class="bi bi-funnel-fill me-1"></i> Apply
    </button>
  </div>

  <!-- ================== Overall Graph ================== -->
  <div class="card shadow-sm rounded-4 mb-5 border-0 overflow-hidden">
    <div class="card-header bg-gradient-orange text-white fw-semibold d-flex align-items-center gap-2">
      <i class="bi bi-graph-up fs-5"></i> Overall Print Trend
    </div>
    <div class="card-body bg-light p-4">
      <canvas id="overallPrintChart" height="180"></canvas>
    </div>
  </div>

  <!-- ================== Bank Sections ================== -->
  <div id="bankSections" class="mb-5">
    <div class="row g-4">

      <!-- Left Panel: Bank Custom Summary -->
      <div class="col-lg-7">
        <div id="customBankRecordsPanel" class="p-3">
          <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h6 class="mb-0">💳 Bank Print Summary</h6>
              <div class="d-flex gap-2">
                <button id="exportExcel_custom" class="btn btn-sm">
                  <i class="bi bi-file-earmark-excel"></i> Excel
                </button>
                <button id="exportPDF_custom" class="btn btn-sm">
                  <i class="bi bi-file-earmark-pdf"></i> PDF
                </button>
              </div>
            </div>

            <!-- Filters -->
            <div class="card-body border-bottom bg-light">
              <div class="row g-2 align-items-end">
                <div class="col-6 col-md-4">
                  <label for="bankSelect_custom" class="form-label mb-1">Bank</label>
                  <select id="bankSelect_custom" class="form-select form-select-sm shadow-sm">
                    <option value="">Select Bank</option>
                  </select>
                </div>
                <div class="col-6 col-md-4">
                  <label for="bankMonth_custom" class="form-label mb-1">Month</label>
                  <input id="bankMonth_custom" type="month" class="form-control form-control-sm shadow-sm">
                </div>
                <div class="col-6 col-md-4">
                  <label for="bankWeek_custom" class="form-label mb-1">Week</label>
                  <input id="bankWeek_custom" type="week" class="form-control form-control-sm shadow-sm">
                </div>
                <div class="col-6 col-md-4">
                  <label for="bankDay_custom" class="form-label mb-1">Day</label>
                  <input id="bankDay_custom" type="date" class="form-control form-control-sm shadow-sm">
                </div>
                <div class="col-md-8">
                  <label class="form-label mb-1">Custom Range</label>
                  <div class="d-flex gap-2">
                    <input id="bankStart_custom" type="date" class="form-control form-control-sm shadow-sm">
                    <input id="bankEnd_custom" type="date" class="form-control form-control-sm shadow-sm">
                  </div>
                </div>
                <div class="col-12 text-end mt-3">
                  <button id="bankApply_custom" class="btn btn-primary btn-sm px-4">
                    <i class="bi bi-funnel-fill"></i> Apply
                  </button>
                </div>
              </div>
            </div>

            <!-- Results Table -->
            <div class="card-body p-0">
              <div class="table-responsive" style="max-height: 380px; overflow-y:auto;">
                <table class="table table-hover align-middle mb-0 text-center">
                  <thead>
                    <tr>
                      <th>Date / Period</th>
                      <th>Total Cards Printed</th>
                    </tr>
                  </thead>
                  <tbody id="bankSummary_custom"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Panel: Bank Jobs Table -->
      <div class="col-lg-5">
        <div class="card h-100 p-4 bg-white">
          <div class="mb-3">
            <label for="bankSelect" class="form-label fw-bold">Select Bank</label>
            <select id="bankSelect" class="form-select form-select-md"></select>
          </div>
          <div class="d-flex flex-wrap gap-2 mb-3 align-items-center">
            <input id="searchInput" type="text" class="form-control form-control-sm" placeholder="🔍 Search by Job ID or Staff" style="flex: 1 1 150px;">
            <input id="dateInput" type="date" class="form-control form-control-sm" style="flex: 1 1 120px;">
            <button id="applyBankJobs" class="btn btn-primary btn-sm">Apply</button>
            <button class="btn btn-outline-success btn-sm ms-auto">📄 Export Excel</button>
            <button class="btn btn-outline-danger btn-sm">🖨️ Export PDF</button>
          </div>
          <div class="table-responsive" style="max-height: 400px; overflow-y:auto;">
            <table class="table table-hover align-middle mb-0 text-center">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Quantity</th>
                  <th>Job ID</th>
                  <th>Staff</th>
                  <th>Machine</th>
                </tr>
              </thead>
              <tbody id="bankJobsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

    </div> <!-- row -->
  </div> <!-- bankSections -->

</div> <!-- cardRecordsPanel -->

<div id="jobManagementPanel" class="p-4 bg-light rounded-4 shadow-sm department-panel" style="display:none;">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h3 class="fw-bold mb-1"><i class="fas fa-briefcase"></i> Job Management</h3>
      <small class="text-muted">Monitor all jobs by bank, shift, and completion status</small>
    </div>
   
  </div>

  <!-- ✅ Filter Section -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-3">
          <label for="filterJobCode" class="form-label fw-semibold">Job Code</label>
          <input type="text" id="filterJobCode" class="form-control" placeholder="Enter Job Code">
        </div>
    <div class="col-md-3">
  <label for="filterBank" class="form-label fw-semibold">Bank</label>
  <select id="filterBank" class="form-select">
    <option value="">All Banks</option>
  </select>
</div>

        <div class="col-md-2">
          <label for="filterShift" class="form-label fw-semibold">Shift</label>
          <select id="filterShift" class="form-select">
            <option value="">All</option>
            <option value="morning">Morning</option>
            <option value="night">Night</option>
          </select>
        </div>
        <div class="col-md-2">
          <label for="filterStartDate" class="form-label fw-semibold">Start Date</label>
          <input type="date" id="filterStartDate" class="form-control">
        </div>
        <div class="col-md-2">
          <label for="filterEndDate" class="form-label fw-semibold">End Date</label>
          <input type="date" id="filterEndDate" class="form-control">
        </div>
      </div>

      <div class="mt-3 text-end">
        <button id="applyFilters" class="btn btn-success btn-sm"><i class="fas fa-filter"></i> Apply Filters</button>
        <button id="resetFilters" class="btn btn-secondary btn-sm"><i class="fas fa-undo"></i> Reset</button>
      </div>
    </div>
  </div>

  <!-- Job Overview Table -->
  <h5 class="mt-3 fw-bold">Job Overview (Batch Summary)</h5>
  <div class="table-responsive mb-4" style="max-height: 300px; overflow-y: auto;">
    <table class="table table-hover table-striped align-middle table-bordered">
      <thead class="table-dark text-center">
        <tr>
          <th>#</th>
          <th>Job Code</th>
          <th>Bank</th>
          <th>Card Ready</th>
          <th>Mailer Ready</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="jobOverviewTableBody" class="text-center"></tbody>
    </table>
  </div>

  <div class="row">
    <!-- Card Printing Table -->
    <div class="col-lg-6 mb-4">
      <h5 class="fw-bold">Card Printing Details</h5>
      <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
        <table class="table table-hover table-striped align-middle table-bordered">
          <thead class="table-dark text-center">
            <tr>
             <th>s/n</th>
              <th>Date / Time</th>
              <th>Shift</th>
              <th>Operator</th>
              <th>Device</th>
              <th>Total Qty</th>
              <th>Completed Qty</th>
              <th>Remaining</th>
            </tr>
          </thead>
          <tbody id="cardPrintingTableBody" class="text-center"></tbody>
        </table>
      </div>
    </div>

    <!-- Mailer Printing Table -->
    <div class="col-lg-6 mb-4">
      <h5 class="fw-bold">Mailer Printing Details</h5>
      <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
        <table class="table table-hover table-striped align-middle table-bordered">
          <thead class="table-dark text-center">
            <tr>
             <th>S/n</th>
              <th>Date / Time</th>
              <th>Shift</th>
              <th>Operator</th>
               <th>Device</th>
               <th>Total Qty</th>
              <th>Completed Qty</th>
              <th>Remaining</th>
            </tr>
          </thead>
          <tbody id="mailerPrintingTableBody" class="text-center"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>




<!-- Machine Report Panel -->
<div id="machineReportPanel" class="p-4 department-panel bg-light" style="display:none; border-radius:12px;">
  <h3 class="mb-4 text-primary fw-bold">⚙️ Machine Report</h3>

  <!-- Filters Row -->
  <div class="row g-3 mb-4">
    <!-- Keyword Search 1 -->
    <div class="col-md-3">
      <input type="text" id="keywordSearch1" class="form-control shadow-sm" placeholder="🔍 Search by keyword...">
    </div>

    <!-- Keyword Search 2 (Report ID or Job ID) -->
    <div class="col-md-3">
      <input type="text" id="keywordSearch2" class="form-control shadow-sm" placeholder="🔍 Search by Report ID...">
    </div>

    <!-- Date Picker -->
    <div class="col-md-3">
      <input type="date" id="datePicker" class="form-control shadow-sm">
    </div>

    <!-- Dropdown: Machine -->
    <div class="col-md-3">
      <select id="machineSelect" class="form-select shadow-sm">
        <option value="">-- Choose Machine --</option>
        <option value="A">Machine A</option>
        <option value="B">Machine B</option>
        <option value="C">Machine C</option>
      </select>
    </div>
  </div>

  <!-- Report List -->
<div id="machineReportList" class="d-flex flex-column gap-3">

    <!-- Example Report Card: Breakdown -->
    <div class="card shadow-sm border-0 rounded-3">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="card-title text-secondary mb-0">Report ID: MR-002</h6>
          <span class="badge bg-danger">Breakdown</span>
        </div>
        <p class="mb-1"><strong>Date of Breakdown:</strong> 2025-08-30</p>
        <p class="text-muted">Machine B required lubrication. Temperature stable at 67°C.</p>
      </div>
    </div>

    <!-- Example Report Card: Maintenance -->
    <div class="card shadow-sm border-0 rounded-3">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="card-title text-secondary mb-0">Report ID: MR-003</h6>
          <span class="badge bg-warning text-dark">Maintenance</span>
        </div>
        <p class="mb-1"><strong>Date of Maintenance:</strong> 2025-08-31</p>
        <p class="text-muted">Machine C showed vibration increase. Scheduled inspection needed.</p>
      </div>
    </div>

    <!-- Example Report Card: Operational -->
    <div class="card shadow-sm border-0 rounded-3">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="card-title text-secondary mb-0">Report ID: MR-004</h6>
          <span class="badge bg-success">Operational</span>
        </div>
        <p class="mb-1"><strong>Status Date:</strong> 2025-09-01</p>
        <p class="text-muted">Machine A running normally. No issues detected.</p>
      </div>
    </div>

  </div>
</div>

<!-- ✅ Staff Management Panel -->
<div id="staffListPanel" class="p-4 bg-light rounded-4 shadow-sm department-panel" style="display:none;">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h3 class="fw-bold mb-1"><i class="fas fa-users"></i> Staff Members</h3>
      <small class="text-muted">View and manage registered staff</small>
    </div>
    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#inviteStaffModal">
      <i class="fas fa-user-plus"></i> Invite Staff
    </button>
  </div>

  <div class="card shadow-sm border-0">
    <div class="card-body">
      <!-- Search -->
      <div class="input-group mb-3">
        <input type="text" class="form-control" id="staffSearch" placeholder="Search by name or email">
        <button class="btn btn-outline-secondary"><i class="fas fa-search"></i></button>
      </div>

      <!-- Modern Staff Table -->
      <div class="table-responsive" style="max-height: 450px; overflow-y: auto;">
        <table class="table table-hover table-striped align-middle">
          <thead class="table-dark">
            <tr>
              <th>#</th>
              <th>Joined</th>
              <th>Firebase UID</th>
              <th>Profile</th>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Department</th>
              <th>Position</th> <!-- ✅ Added this -->
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody id="staffTableBody">
            <!-- Filled dynamically with JS -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<!-- ✅ Invite Staff Modal -->
<div class="modal fade" id="inviteStaffModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 shadow-lg">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title"><i class="fas fa-user-plus"></i> Invite New Staff</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <form id="inviteStaffForm">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" id="inviteEmail" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Role</label>
            <input type="text" class="form-control" id="inviteRole" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Department</label>
            <select class="form-select" id="inviteDepartment">
              <option value="">Select Department</option>
              <option value="1">IT</option>
              <option value="2">HR</option>
              <option value="3">Finance</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Position</label>
            <select class="form-select" id="invitePosition" required>
              <option value="">Select Position</option>
              <option value="QC Officer">QC Officer</option>
              <option value="Mailer Officer">Mailer Officer</option>
              <option value="Card Distributor">Card Distributor</option>
              <option value="Machine Operator">Machine Operator</option>
              <option value="Admin">Admin</option>
              <option value="HR">HR</option>
              <option value="Production Manager">Production Manager</option>
              <option value="Graphics/CTP">Graphics/CTP</option>
              <option value="Personnel">Personnel</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Send Invite</button>
        </div>
      </form>
    </div>
  </div>
</div>


<!-- ✅ Edit Staff Modal -->
<div class="modal fade" id="editStaffModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 shadow-lg">
      <div class="modal-header bg-warning">
        <h5 class="modal-title"><i class="fas fa-edit"></i> Edit Staff</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="editStaffForm">
        <div class="modal-body">
          <input type="hidden" id="editStaffId">
          <div class="mb-3">
            <label class="form-label">Name</label>
            <input type="text" id="editStaffName" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Role</label>
            <input type="text" id="editStaffRole" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Department</label>
            <select id="editStaffDepartment" class="form-select"></select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-warning">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ✅ Delete Confirmation Modal -->
<div class="modal fade" id="deleteStaffModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 shadow-lg">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title"><i class="fas fa-trash"></i> Delete Staff</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this staff member?
        <input type="hidden" id="deleteStaffId">
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button id="confirmDeleteStaff" class="btn btn-danger">Delete</button>
      </div>
    </div>
  </div>
</div>


<!-- ✅ Toasts -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 2000;">
  <div id="successToast" class="toast align-items-center text-white bg-success border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body" id="successToastBody">Success!</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>

  <div id="errorToast" class="toast align-items-center text-white bg-danger border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body" id="errorToastBody">Something went wrong.</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>


</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ✅ Toast Functions
function showSuccess(message = "Success!") {
  document.getElementById('successToastBody').textContent = message;
  new bootstrap.Toast(document.getElementById('successToast')).show();
}

function showError(message = "Something went wrong.") {
  document.getElementById('errorToastBody').textContent = message;
  new bootstrap.Toast(document.getElementById('errorToast')).show();
}

// ✅ Populate Department Dropdown dynamically
async function populateDepartmentDropdown() {
  try {
    const res = await fetch('/api/departments');
    const departments = await res.json();

    const select = document.getElementById('inviteDepartment');
    select.innerHTML = '<option value="">Select Department</option>';

    departments.forEach(dept => {
      const option = document.createElement('option');
      option.value = dept.id;
      option.textContent = dept.name;
      select.appendChild(option);
    });
  } catch (err) {
    console.error("Failed to load departments:", err);
  }
}

// ✅ Load departments whenever modal opens
const inviteModal = document.getElementById('inviteStaffModal');
if (inviteModal) {
  inviteModal.addEventListener('show.bs.modal', populateDepartmentDropdown);
}

// ✅ Handle Staff Invite Form Submission
document.getElementById('inviteStaffForm').addEventListener('submit', async function (e) {
  e.preventDefault();

  const email = document.getElementById('inviteEmail').value.trim();
  const role = document.getElementById('inviteRole').value;
  const department_id = document.getElementById('inviteDepartment').value || null;
  const position = document.getElementById('invitePosition').value; // 🆕 Added position

  try {
    const response = await fetch('/api/staff/invite', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      // 🆕 Include position in JSON body
      body: JSON.stringify({ email, role, department_id, position })
    });

    const resultText = await response.text();
    let result;

    try {
      result = JSON.parse(resultText);
    } catch {
      throw new Error('Server returned non-JSON: ' + resultText.slice(0, 100));
    }

    if (response.ok) {
      showSuccess("Invitation email sent successfully!");
      document.getElementById('inviteStaffForm').reset();
      const modal = bootstrap.Modal.getInstance(inviteModal);
      modal.hide();

      if (typeof loadStaffList === 'function') loadStaffList();
    } else {
      const errorMessage = result.error || result.message || 'Something went wrong';
      showError(errorMessage);
    }
  } catch (err) {
    showError('Network or unexpected error: ' + err.message);
    console.error(err);
  }
});

// ✅ Load staff list into table
async function loadStaffList() {
  try {
    const res = await fetch('/api/staff/all'); // GET all staff
    const staff = await res.json();

    const tbody = document.getElementById('staffTableBody');
    tbody.innerHTML = '';

    staff.forEach((s, index) => {
      const joinedDate = new Date(s.created_at).toLocaleDateString('en-GB'); // DD/MM/YYYY
      const tr = document.createElement('tr');

      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${joinedDate}</td>
        <td>${s.firebase_uid}</td>
        <td>
          <img src="${s.profile_picture || 'https://via.placeholder.com/40'}" 
               alt="Profile" class="rounded-circle" width="40" height="40">
        </td>
        <td>${s.name}</td>
        <td>${s.email}</td>
        <td>${s.role}</td>
        <td>${s.department_id || '-'}</td>
        <td>${s.position || '-'}</td> <!-- ✅ Added Position column -->
        <td class="text-center">
          <button class="btn btn-sm btn-warning me-2" 
            onclick="openEditModal(${s.id}, '${s.name}', '${s.username}', '${s.profile_picture || ''}')">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn btn-sm btn-danger" onclick="openDeleteModal(${s.id})">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      `;

      tbody.appendChild(tr);
    });
  } catch (err) {
    showError('Failed to load staff list');
    console.error(err);
  }
}


// ✅ Edit Staff Modal
function openEditModal(id, name, username, profile_picture) {
  document.getElementById('editStaffId').value = id;
  document.getElementById('editStaffName').value = name;
  document.getElementById('editStaffUsername').value = username;
  document.getElementById('editStaffProfile').value = profile_picture || '';

  const modal = new bootstrap.Modal(document.getElementById('editStaffModal'));
  modal.show();
}

document.getElementById('editStaffForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const id = document.getElementById('editStaffId').value;
  const name = document.getElementById('editStaffName').value;
  const username = document.getElementById('editStaffUsername').value;
  const profile_picture = document.getElementById('editStaffProfile').value;

  try {
    const res = await fetch('/api/staff/edit', {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id, name, username, profile_picture })
    });
    const data = await res.json();

    if (res.ok) {
      showSuccess(data.message);
      loadStaffList();
      const modal = bootstrap.Modal.getInstance(document.getElementById('editStaffModal'));
      modal.hide();
    } else {
      showError(data.error || data.message);
    }
  } catch (err) {
    showError('Failed to edit staff');
    console.error(err);
  }
});

// ✅ Delete Staff Modal
function openDeleteModal(id) {
  document.getElementById('deleteStaffId').value = id;
  const modal = new bootstrap.Modal(document.getElementById('deleteStaffModal'));
  modal.show();
}

document.getElementById('confirmDeleteStaff').addEventListener('click', async () => {
  const id = document.getElementById('deleteStaffId').value;
  try {
    const res = await fetch(`/api/staff/delete/${id}`, { method: 'DELETE' });
    const data = await res.json();

    if (res.ok) {
      showSuccess(data.message);
      loadStaffList();
      const modal = bootstrap.Modal.getInstance(document.getElementById('deleteStaffModal'));
      modal.hide();
    } else {
      showError(data.error || data.message);
    }
  } catch (err) {
    showError('Failed to delete staff');
    console.error(err);
  }
});

// ✅ Initial load
loadStaffList();
document.addEventListener("DOMContentLoaded", () => {

  // ===================== OVERALL SUMMARY =====================
  async function loadOverallSummary() {
    try {
      const res = await fetch("/api/card-jobs/summary");
      const data = await res.json();
      document.getElementById("todayCount").textContent = data.today ?? 0;
      document.getElementById("weekCount").textContent = data.week ?? 0;
      document.getElementById("monthCount").textContent = data.month ?? 0;
      document.getElementById("topBank").textContent = data.topBank ?? "N/A";
    } catch (err) {
      console.error("Error loading overall summary:", err);
    }
  }

  // ===================== MULTI-BANK TREND =====================
  let overallChart;
  async function loadOverallTrend() {
    const bankId = document.getElementById("overallBankSelect").value;
    const filterType = document.getElementById("overallFilterType").value;

    let date;
    if (filterType === "week") date = document.getElementById("overallWeek")?.value;
    else if (filterType === "month") date = document.getElementById("overallMonth")?.value;

    if (!filterType) return;
    if (!date && filterType !== "custom") return;

    const start = document.getElementById("overallStartDate")?.value;
    const end = document.getElementById("overallEndDate")?.value;

    let query = `filterType=${filterType}`;
    if (filterType === "custom") {
      if (!start || !end) {
        alert("Please select start and end dates for custom range");
        return;
      }
      query += `&start=${start}&end=${end}`;
    } else {
      query += `&date=${date}`;
    }
    if (bankId) query += `&bankId=${bankId}`;

    try {
      const res = await fetch(`/api/card-jobs/multi-bank?${query}`);
      const data = await res.json();
      console.log("Multi-Bank Trend Data:", data);

      let labels = [];
      let datasets = [];

      if (!data.selectedBank.length && !data.otherBanks.length) {
        labels = ["No Data"];
        datasets = [{ label: "Cards Printed", data: [0], backgroundColor: "rgba(54,162,235,0.6)" }];
      } else {
        if (filterType === "week") labels = data.selectedBank.map(d => d.day);
        else if (filterType === "month") labels = data.selectedBank.map(d => `Week ${d.week}`);
        else labels = data.selectedBank.map(d => d.date || d.actual_date);

        datasets.push({
          label: "Selected Bank",
          data: data.selectedBank.map(d => d.total),
          borderColor: "#FF6700",
          backgroundColor: "rgba(255,103,0,0.3)",
          borderWidth: 2,
          tension: 0.4
        });

        data.otherBanks.forEach(bank => {
          datasets.push({
            label: bank.bankName,
            data: bank.data.map(d => d.total),
            borderColor: "#2196F3",
            backgroundColor: "rgba(33,150,243,0.2)",
            borderWidth: 2,
            tension: 0.4
          });
        });
      }

      const ctx = document.getElementById("overallPrintChart").getContext("2d");
      if (overallChart) overallChart.destroy();
      overallChart = new Chart(ctx, {
        type: filterType === "day" || filterType === "custom" ? "bar" : "line",
        data: { labels, datasets },
        options: {
          responsive: true,
          plugins: { legend: { position: "top" } },
          scales: {
            x: { title: { display: true, text: filterType === "month" ? "Weeks" : "Days" } },
            y: { title: { display: true, text: "Cards Printed" }, beginAtZero: true }
          }
        }
      });

    } catch (err) {
      console.error("Error loading overall trend:", err);
    }
  }

  // ===================== BANK CUSTOM SUMMARY =====================
  async function loadBankCustomSummary() {
    const bankId = document.getElementById("bankSelect_custom").value;
    const month = document.getElementById("bankMonth_custom").value;
    const week = document.getElementById("bankWeek_custom").value;
    const day = document.getElementById("bankDay_custom").value;
    const start = document.getElementById("bankStart_custom").value;
    const end = document.getElementById("bankEnd_custom").value;

    if (!bankId) {
      alert("Please select a bank.");
      return;
    }

    let query = `bankId=${bankId}`;
    if (start && end) query += `&filterType=custom&start=${start}&end=${end}`;
    else if (day) query += `&filterType=day&date=${day}`;
    else if (week) query += `&filterType=week&date=${week}`;
    else if (month) query += `&filterType=month&date=${month}`;
    else query += `&filterType=month`;

    try {
      const res = await fetch(`/api/card-jobs/bank-calendar-summary?${query}`);
      const data = await res.json();
      console.log(data)
      const tbody = document.getElementById("bankSummary_custom");
      tbody.innerHTML = "";

      if (!data.length) {
        tbody.innerHTML = `<tr><td colspan="2" class="text-muted">No data available</td></tr>`;
        return;
      }

      data.forEach(item => {
        const period = item.actual_date ?? item.date ?? item.day ?? item.week ?? "N/A";
        const total = Number(item.total ?? item.total_cards ?? 0);
        tbody.insertAdjacentHTML("beforeend", `<tr><td>${period}</td><td>${total}</td></tr>`);
      });
    } catch (error) {
      console.error("Error loading bank custom summary:", error);
    }
  }

  // ===================== BANK JOBS TABLE =====================
  async function loadBankJobs() {
    const bankId = document.getElementById("bankSelect").value;
    const search = document.getElementById("searchInput").value.trim();
    const date = document.getElementById("dateInput").value;

    if (!bankId) {
      alert("Please select a bank.");
      return;
    }

    let query = `bankId=${bankId}`;
    if (search) query += `&search=${encodeURIComponent(search)}`;
    if (date) query += `&date=${date}`;

    try {
      const res = await fetch(`/api/card-jobs/bank-jobs?${query}`);
      const data = await res.json();
      const tbody = document.getElementById("bankJobsTableBody");
      tbody.innerHTML = "";

      if (!data.length) {
        tbody.innerHTML = `<tr><td colspan="5" class="text-muted">No records found</td></tr>`;
        return;
      }

      data.forEach(item => {
        const dateVal = item.actual_date ?? item.date ?? "N/A";
        const qty = Number(item.completed_qty ?? 0);
        const jobCode = item.job_code ?? "N/A";
        const staff = item.staff ?? "N/A";
        const device = item.device_name ?? "N/A";

        tbody.insertAdjacentHTML(
          "beforeend",
          `<tr>
            <td>${dateVal}</td>
            <td>${qty}</td>
            <td>${jobCode}</td>
            <td>${staff}</td>
            <td>${device}</td>
          </tr>`
        );
      });
    } catch (err) {
      console.error("Error loading bank jobs:", err);
    }
  }

  // ===================== LOAD BANKS =====================
  async function loadBanks() {
    try {
      const res = await fetch("/api/banks");
      const banks = await res.json();

      const overallSelect = document.getElementById("overallBankSelect");
      const bankSelectCustom = document.getElementById("bankSelect_custom");
      const bankSelect = document.getElementById("bankSelect");

      [overallSelect, bankSelectCustom, bankSelect].forEach(sel => {
        sel.innerHTML =
          `<option value="">Select Bank</option>` +
          banks.map(b => `<option value="${b.bank_id}">${b.bank_name}</option>`).join("");
      });

      loadOverallSummary();
    } catch (err) {
      console.error("Error loading banks:", err);
    }
  }

  // ===================== EVENT LISTENERS =====================
  document.getElementById("applyOverall").addEventListener("click", loadOverallTrend);
  document.getElementById("bankApply_custom").addEventListener("click", loadBankCustomSummary);
  document.getElementById("applyBankJobs").addEventListener("click", loadBankJobs);

  // ===================== INIT =====================
  loadBanks();
});










</script>

<script>
    // Sidebar Toggle
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        sidebar.classList.toggle('expanded');
        if (window.innerWidth <= 768) {
            overlay.classList.toggle('active', sidebar.classList.contains('expanded'));
        }
    }
    
    // Navigation Panel Switching
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('data-target');
            if (!targetId) return;
            document.querySelectorAll('.department-panel').forEach(panel => panel.style.display = 'none');
            document.getElementById(targetId).style.display = 'block';
            if (window.innerWidth <= 768) toggleSidebar();
        });
    });



// deviceUsage.js
window.addEventListener("DOMContentLoaded", () => {
  // ================================
  // DOM ELEMENTS
  // ================================
  const deviceSelect = document.getElementById("deviceSelect");
  const timeRangeSelect = document.getElementById("timeRangeSelect");
  const weekPicker = document.getElementById("weekPicker");
  const monthPicker = document.getElementById("monthPicker");
  const chartCanvas = document.getElementById("deviceUsageChart");
  const chartTitle = document.getElementById("chartTitle");
  const jobsTableBody = document.getElementById("jobsTableBody");
  const jobsTableHeader = jobsTableBody.closest("table").querySelector("thead tr");

  const tonerDeviceSelect = document.getElementById("tonerDeviceSelect");
  const tonerTableBody = document.getElementById("tonerTableBody");
  const tonerSearchInput = document.getElementById("tonerSearch");
  const tonerSearchBtn = document.getElementById("tonerSearchBtn");
  const tonerDateStart = document.getElementById("tonerDateRangeStart");
  const tonerDateEnd = document.getElementById("tonerDateRangeEnd");
  const tonerDateSearchBtn = document.getElementById("tonerDateSearchBtn");

  // ================================
  // STATE
  // ================================
  let deviceChart = null;
  let allJobs = [];
  let allToners = [];
  let currentDeviceType = "printer";

  // ================================
  // LOAD DEVICES
  // ================================
  async function loadDevices() {
    try {
      const res = await fetch("/api/devices");
      const devices = await res.json();

      deviceSelect.innerHTML = `<option value="">-- Select Device --</option>`;
      tonerDeviceSelect.innerHTML = `<option value="">-- Select Device --</option>`;

      devices.forEach(d => {
        const opt1 = document.createElement("option");
        opt1.value = d.device_id;
        opt1.textContent = `${d.device_name} (${d.device_type})`;
        opt1.dataset.type = d.device_type;
        deviceSelect.appendChild(opt1);

        const opt2 = document.createElement("option");
        opt2.value = d.device_id;
        opt2.textContent = `${d.device_name} (${d.device_type})`;
        opt2.dataset.type = d.device_type;
        tonerDeviceSelect.appendChild(opt2);
      });
    } catch (err) {
      console.error("❌ Failed to load devices:", err);
    }
  }

  // ================================
  // JOBS TABLE
  // ================================
  function updateJobsTableHeader(deviceType) {
    if (deviceType === "printer") {
      jobsTableHeader.innerHTML = `
        <th>Job Code</th>
        <th>Range Start</th>
        <th>Range End</th>
        <th>Completed Qty</th>
      `;
    } else {
      jobsTableHeader.innerHTML = `
        <th>Job Code</th>
        <th>Date & Time</th>
        <th>Card Type</th>
        <th>Completed Qty</th>
        <th>Rejected Qty</th>
      `;
    }
  }

  function renderJobs(jobs, deviceType) {
    jobsTableBody.innerHTML = "";
    if (!jobs.length) {
      jobsTableBody.innerHTML = `<tr><td colspan="5" class="text-center text-muted">No jobs found</td></tr>`;
      return;
    }

    jobs.forEach(j => {
      const tr = document.createElement("tr");
      if (deviceType === "printer") {
        tr.innerHTML = `
          <td>${j.job_code}</td>
          <td>${j.range_start || 0}</td>
          <td>${j.range_end || 0}</td>
          <td>${j.completed_qty || (j.range_end - j.range_start + 1) || 0}</td>
        `;
      } else {
        tr.innerHTML = `
          <td>${j.job_code}</td>
          <td>${new Date(j.created_at).toLocaleString()}</td>
          <td>${j.card_type || "N/A"}</td>
          <td>${j.completed_qty || 0}</td>
          <td>${j.rejected_qty || 0}</td>
        `;
      }
      jobsTableBody.appendChild(tr);
    });
  }

  // ================================
  // TONER TABLE
  // ================================
  function renderTonerTable(records) {
    tonerTableBody.innerHTML = "";
    if (!records.length) {
      tonerTableBody.innerHTML = `<tr><td colspan="5" class="text-center text-muted">No records found</td></tr>`;
      return;
    }

    records.sort((a, b) => new Date(b.install_date) - new Date(a.install_date))
      .forEach(t => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${t.toner_code || t.encoder_code || "N/A"}</td>
          <td>${t.device_name || "N/A"}</td>
          <td>${new Date(t.install_date).toLocaleDateString()}</td>
          <td>${t.replace_date ? new Date(t.replace_date).toLocaleDateString() : ""}</td>
          <td>${t.total || t.total_prints || 0}</td>
        `;
        tonerTableBody.appendChild(tr);
      });
  }

  // ================================
  // GRAPH HELPERS
  // ================================
  function getWeekNumber(d) {
    const date = new Date(d);
    const start = new Date(date.getFullYear(), 0, 1);
    const diff = date - start + ((start.getDay() + 6) % 7) * 86400000;
    return Math.ceil(diff / 604800000);
  }

  function getDayName(d) {
    return new Date(d).toLocaleDateString("en-US", { weekday: "short" });
  }

  function buildGraphData(jobs, deviceType, viewType, selectedDate) {
    const data = {};

    if (!jobs || jobs.length === 0) return data;

    if (viewType === "week") {
      jobs.forEach(j => {
        const jobDate = new Date(j.created_at);
        const week = getWeekNumber(jobDate);
        if (selectedDate && parseInt(selectedDate) !== week) return;
        const day = getDayName(jobDate);
        if (!data[day]) data[day] = 0;

        const qty = j.completed_qty || (deviceType === "printer" ? (j.range_end - j.range_start + 1) : 0);
        data[day] += qty;
      });
    } else if (viewType === "month") {
      jobs.forEach(j => {
        const jobDate = new Date(j.created_at);
        const firstDayOfMonth = new Date(jobDate.getFullYear(), jobDate.getMonth(), 1);
        const weekOfMonth = Math.ceil((jobDate.getDate() + firstDayOfMonth.getDay()) / 7);
        const key = `Week ${weekOfMonth}`;
        if (!data[key]) data[key] = 0;

        const qty = j.completed_qty || (deviceType === "printer" ? (j.range_end - j.range_start + 1) : 0);
        data[key] += qty;
      });
    }

    return data;
  }

  function renderChart(graphData, deviceType, viewType) {
    if (!graphData || Object.keys(graphData).length === 0) {
      chartCanvas.style.display = "none";
      return;
    }

    chartCanvas.style.display = "block";
    const labels = Object.keys(graphData);
    const dataValues = labels.map(label => graphData[label]);

    if (deviceChart) deviceChart.destroy();
    deviceChart = new Chart(chartCanvas, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: `${deviceType.toUpperCase()} Usage`,
          data: dataValues,
          borderWidth: 2,
          fill: false,
          tension: 0.3,
          borderColor: "#0d6efd"
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: "bottom" },
          title: { display: true, text: `${deviceType.toUpperCase()} Usage Trend (${viewType})` }
        },
        scales: { y: { beginAtZero: true } }
      }
    });

    chartTitle.textContent = `${deviceType.toUpperCase()} Usage Trend (${viewType})`;
  }

  // ================================
  // FETCH DEVICE DATA
  // ================================
  async function fetchDeviceData() {
    const deviceId = deviceSelect.value;
    if (!deviceId) return;

    const viewType = timeRangeSelect.value;
    const selectedDate = viewType === "week" ? weekPicker.value : monthPicker.value;

    try {
      const historyRes = await fetch(`/api/devices/${deviceId}/history?view=${viewType}`);
      if (!historyRes.ok) throw new Error(`Server responded with status ${historyRes.status}`);
      const historyData = await historyRes.json();

      allJobs = historyData.jobs || [];
      currentDeviceType = historyData.deviceType || "printer";

      updateJobsTableHeader(currentDeviceType);
      renderJobs(allJobs, currentDeviceType);

      const graphData = buildGraphData(allJobs, currentDeviceType, viewType, selectedDate);
      renderChart(graphData, currentDeviceType, viewType);
    } catch (err) {
      console.error("❌ Device data fetch error:", err);
      jobsTableBody.innerHTML = `<tr><td colspan="5" class="text-center text-danger">Failed to load jobs</td></tr>`;
    }
  }

  // ================================
  // FETCH TONERS
  // ================================
  async function fetchToners() {
    const deviceId = tonerDeviceSelect.value;
    if (!deviceId) {
      tonerTableBody.innerHTML = `<tr><td colspan="5" class="text-center text-muted">Please select a device</td></tr>`;
      return;
    }

    currentDeviceType = tonerDeviceSelect.selectedOptions[0]?.dataset.type || "printer";

    try {
      tonerTableBody.innerHTML = `<tr><td colspan="5" class="text-center">Loading...</td></tr>`;
      const res = await fetch(`/api/devices/${deviceId}/usage`);
      if (!res.ok) throw new Error(`Server responded with status ${res.status}`);
      const data = await res.json();
      allToners = data.usage || [];
      renderTonerTable(allToners);
    } catch (err) {
      console.error("❌ Failed to fetch toner/encoder usage:", err);
      tonerTableBody.innerHTML = `<tr><td colspan="5" class="text-center text-danger">Failed to load records</td></tr>`;
    }
  }

  // ================================
  // EVENTS
  // ================================
  deviceSelect.addEventListener("change", fetchDeviceData);
  timeRangeSelect.addEventListener("change", () => {
    if (timeRangeSelect.value === "week") {
      weekPicker.style.display = "block";
      monthPicker.style.display = "none";
    } else {
      weekPicker.style.display = "none";
      monthPicker.style.display = "block";
    }
    fetchDeviceData();
  });

  weekPicker.addEventListener("change", fetchDeviceData);
  monthPicker.addEventListener("change", fetchDeviceData);

  tonerDeviceSelect.addEventListener("change", fetchToners);
  tonerSearchBtn.addEventListener("click", () => {
    const val = tonerSearchInput.value.trim().toLowerCase();
    if (!val) return renderTonerTable(allToners);
    const filtered = allToners.filter(t => (t.toner_code || t.encoder_code || "").toLowerCase().includes(val));
    renderTonerTable(filtered);
  });
  tonerDateSearchBtn.addEventListener("click", () => {
    const start = tonerDateStart.value ? new Date(tonerDateStart.value) : null;
    const end = tonerDateEnd.value ? new Date(tonerDateEnd.value) : null;
    const filtered = allToners.filter(t => {
      const d = new Date(t.install_date);
      if (start && d < start) return false;
      if (end && d > end) return false;
      return true;
    });
    renderTonerTable(filtered);
  });

  // ================================
  // INITIAL LOAD
  // ================================
  loadDevices();
});





//function for job list for stafff dashbpard
window.addEventListener('DOMContentLoaded', () => {
    // ✅ DOM Elements
    const staffSelect = document.getElementById('staffSelect');
    const jobTableBody = document.getElementById('staffJobsTableBody');
    const jobSearchInput = document.getElementById('jobSearchjob');
    const jobSearchBtn = document.getElementById('jobSearchBtnjob');
    const customDateStart = document.getElementById('customDateStart');
    const customDateEnd = document.getElementById('customDateEnd');
    const customDateBtn = document.getElementById('customDateSearchBtnjob');
    const staffChartCanvas = document.getElementById('staffJobChart');

    if (!staffSelect || !jobTableBody || !staffChartCanvas) {
        console.error('❌ Missing required DOM elements.');
        return;
    }

    let allStaff = [];
    let allJobs = [];
    let currentStaff = null;

    // 🔹 Load all staff (Mailer Officers + Machine Operators)
    async function loadStaff() {
        try {
            const res = await fetch('/api/person-team/staff');
            allStaff = await res.json();
            staffSelect.innerHTML = '<option value="">-- Select Staff --</option>';

            allStaff.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s.id;
                opt.textContent = `${s.name} (${s.position})`;
                staffSelect.appendChild(opt);
            });
        } catch (err) {
            console.error('❌ Failed to load staff:', err);
        }
    }

    // 🔹 Fetch jobs for selected staff (initial load, no date filter)
    async function fetchJobsForStaff() {
        const userId = staffSelect.value;
        if (!userId) return;

        currentStaff = allStaff.find(s => s.id == userId);
        if (!currentStaff) return;

        try {
            let url = currentStaff.position.toLowerCase().includes('operator')
                ? `/api/person-team/staff/${userId}/cardjobs`
                : `/api/person-team/staff/${userId}/jobs`;

            console.log('🔹 Fetching jobs for staff:', url);

            const res = await fetch(url);
            const data = await res.json();

            allJobs = Array.isArray(data) ? data : data.jobs || [];

            renderJobTable(allJobs, data.noJobDays);
            renderJobChart(allJobs);
        } catch (err) {
            console.error('❌ Failed to fetch jobs:', err);
        }
    }

    // 🔹 Fetch jobs with custom date filter
    async function fetchJobsByDate() {
        const userId = staffSelect.value;
        if (!userId) {
            alert('Please select a staff first');
            return;
        }

        currentStaff = allStaff.find(s => s.id == userId);
        if (!currentStaff) return;

        let url = currentStaff.position.toLowerCase().includes('operator')
            ? `/api/person-team/staff/${userId}/cardjobs`
            : `/api/person-team/staff/${userId}/jobs`;

        const params = new URLSearchParams();
        if (customDateStart.value) params.append('startDate', customDateStart.value);
        if (customDateEnd.value) params.append('endDate', customDateEnd.value);
        if ([...params].length > 0) url += '?' + params.toString();

        console.log('🔹 Fetching jobs with date filter:', url);

        try {
            const res = await fetch(url);
            const data = await res.json();
            const filteredJobs = Array.isArray(data) ? data : data.jobs || [];

            renderJobTable(filteredJobs, data.noJobDays);
            renderJobChart(filteredJobs);
        } catch (err) {
            console.error('❌ Failed to fetch jobs by date:', err);
        }
    }

    // 🔹 Render job table (for both Mailer & Operator)
    function renderJobTable(jobs, noJobDays = []) {
        jobTableBody.innerHTML = '';
        const tableHead = document.querySelector('#jobTable thead');
        if (!tableHead) return;

        // 🟠 If no jobs but backend provided "no job days"
        if ((!jobs || jobs.length === 0) && noJobDays.length > 0) {
            tableHead.innerHTML = `<tr><th>Date</th><th>Status</th></tr>`;
            noJobDays.forEach(day => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${day.day}</td><td>${day.message}</td>`;
                jobTableBody.appendChild(tr);
            });
            return;
        }

        if (!jobs.length) {
            jobTableBody.innerHTML = `<tr><td colspan="8" class="text-center text-muted">No jobs found</td></tr>`;
            return;
        }

        const isCardJob = !!jobs[0].card_job_id;

        if (isCardJob) {
            // 🟢 Machine Operator jobs
            tableHead.innerHTML = `
                <tr>
                    <th>Time/Date</th>
                    <th>Job Code</th>
                    <th>Card Type</th>
                    <th>Qty</th>
                    <th>Completed</th>
                    <th>Rejected</th>
                    <th>Bank</th>
                    <th>Device</th>
                </tr>
            `;
            jobs.forEach(j => {
                const createdAt = new Date(j.created_at);
                const dateStr = createdAt.toLocaleDateString('en-US', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
                const timeStr = createdAt.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
                const formatted = `${dateStr} at ${timeStr}`;

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formatted}</td>
                    <td>${j.job_code}</td>
                    <td>${j.card_type}</td>
                    <td>${j.card_quantity}</td>
                    <td>${j.completed_qty}</td>
                    <td>${j.rejected_qty}</td>
                    <td>${j.bank_name || j.bank_id}</td>
                    <td>${j.device_name || j.device_id}</td>
                `;
                jobTableBody.appendChild(tr);
            });
        } else {
            // 🔵 Mailer Officer jobs
            tableHead.innerHTML = `
                <tr>
                    <th>Job Code</th>
                    <th>Time</th>
                    <th>Date</th>
                    <th>Qty Printed</th>
                    <th>Amount</th>
                    <th>Range</th>
                    <th>Device</th>
                    <th>Staff</th>
                </tr>
            `;
            jobs.forEach(j => {
                const qty = j.range_end != null && j.range_start != null ? j.range_end - j.range_start : 0;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${j.job_code}</td>
                    <td>${new Date(j.created_at).toLocaleTimeString()}</td>
                    <td>${new Date(j.created_at).toLocaleDateString()}</td>
                    <td>${qty}</td>
                    <td>-</td>
                    <td>${j.range_start}-${j.range_end}</td>
                    <td>${j.device_name || j.device_id}</td>
                    <td>${j.operator_name || currentStaff.name}</td>
                `;
                jobTableBody.appendChild(tr);
            });
        }
    }

    // 🔹 Render chart
    function renderJobChart(jobs) {
        const ctx = staffChartCanvas.getContext('2d');
        const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const data = days.map(() => 0);

        jobs.forEach(j => {
            const day = new Date(j.created_at).getDay(); // 0=Sun
            let qty = 0;
            if (j.range_start != null && j.range_end != null) qty = j.range_end - j.range_start;
            else if (j.completed_qty != null) qty = j.completed_qty;
            else if (j.card_quantity != null) qty = j.card_quantity;
            if (day >= 1 && day <= 6) data[day - 1] += qty;
        });

        if (window.staffChart) window.staffChart.destroy();

        window.staffChart = new Chart(ctx, {
            type: 'bar',
            data: { labels: days, datasets: [{ label: 'Qty', data, backgroundColor: 'rgba(54,162,235,0.6)' }] },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true, title: { display: true, text: 'Quantity' } } },
            },
        });
    }

    // 🔹 Search Job Code
    jobSearchBtn.addEventListener('click', () => {
        const val = jobSearchInput.value.trim().toLowerCase();
        if (!val) {
            renderJobTable(allJobs); // Reset if input empty
            return;
        }

        const filtered = allJobs.filter(j =>
            (j.job_code || j.job_id || '').toLowerCase().includes(val)
        );

        if (filtered.length === 0) {
            jobTableBody.innerHTML = `<tr><td colspan="8" class="text-center text-muted">No job found for "${val}"</td></tr>`;
            return;
        }

        renderJobTable(filtered);
    });

    // 🔹 Event Listeners
    staffSelect.addEventListener('change', fetchJobsForStaff);
    customDateBtn.addEventListener('click', fetchJobsByDate);

    // 🔹 Initialize
    loadStaff();
});



// fetch sumary data for devices total, jobh id printed 
//for it
window.addEventListener("DOMContentLoaded", async () => {
  const deviceSelect = document.getElementById("totalPrintDevice");
  const startDateInput = document.getElementById("customStartDate");
  const endDateInput = document.getElementById("customEndDate");
  const runBtn = document.getElementById("runCustomQuery");
  const totalValueEl = document.getElementById("startCustomTotalValue");
  const rawDataEl = document.getElementById("startCustomRawData");

  // ================================
  // Load Devices into dropdown
  // ================================
  async function loadDevices() {
    try {
      const res = await fetch("/api/devices");
      const devices = await res.json();

      deviceSelect.innerHTML = `<option value="">-- Select Device --</option>`;
      devices.forEach(d => {
        const opt = document.createElement("option");
        opt.value = d.device_id;
        opt.textContent = `${d.device_name} (${d.device_type})`;
        opt.dataset.type = d.device_type.toLowerCase(); // printer or card
        deviceSelect.appendChild(opt);
      });
    } catch (err) {
      console.error("Failed to load devices:", err);
    }
  }

  // ================================
  // Fetch prints for selected device/date range
  // ================================
  async function fetchCustomPrints() {
    const deviceId = deviceSelect.value;
    const deviceType = deviceSelect.selectedOptions[0]?.dataset.type;
    const start = startDateInput.value;
    const end = endDateInput.value;

    if (!deviceId || !start || !end) {
      alert("Please select device, start date, and end date.");
      return;
    }

    try {
      rawDataEl.textContent = "Loading data...";
      totalValueEl.textContent = "0";

      const url = `/api/checktotal/${deviceId}/custom-prints?start=${start}&end=${end}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Server error: ${res.status}`);
      const data = await res.json();

      const recordsByDay = data.recordsByDay || {};
      const totalPrints = data.totalPrints || 0;

      // Update the total prints div
      totalValueEl.textContent = totalPrints;

      // Build breakdown text
      let breakdownText = "";
      Object.keys(recordsByDay).sort().forEach(day => {
        const dayData = recordsByDay[day];
        breakdownText += `${day} - Total: ${dayData.dayTotal} prints\n`;

        dayData.jobs.forEach(job => {
          const jobText = deviceType === "printer"
            ? `  ${job.job_code}: ${job.prints} prints`
            : `  ${job.job_code}: ${job.prints} prints (Rejected: ${job.rejected_qty || 0})`;
          breakdownText += jobText + "\n";
        });
      });

      rawDataEl.textContent = breakdownText || "No prints found for this range.";

    } catch (err) {
      console.error("Failed to fetch custom prints:", err);
      rawDataEl.textContent = "Error fetching data. Check console.";
    }
  }

  // ================================
  // Event Listeners
  // ================================
  runBtn.addEventListener("click", fetchCustomPrints);

  // Load devices on page load
  loadDevices();
});
document.addEventListener("DOMContentLoaded", () => {
  const cardPrintingTableBody = document.getElementById("cardPrintingTableBody");
  const mailerPrintingTableBody = document.getElementById("mailerPrintingTableBody");

  const filterJobCode = document.getElementById("filterJobCode");
  const filterBank = document.getElementById("filterBank");
  const filterShift = document.getElementById("filterShift");
  const filterStartDate = document.getElementById("filterStartDate");
  const filterEndDate = document.getElementById("filterEndDate");

  const applyFiltersBtn = document.getElementById("applyFilters");
  const resetFiltersBtn = document.getElementById("resetFilters");

  let allJobs = [];
  let isFiltered = false;

  // =========================================================
  // 🔹 Load Banks for Dropdown
  // =========================================================
  async function loadBanks() {
    try {
      const res = await fetch("/api/banks");
      const banks = await res.json();

      filterBank.innerHTML = `<option value="">All Banks</option>`;

      banks.forEach(bank => {
        const displayName = bank.bank_code
          ? `${bank.bank_code} - ${bank.bank_name}`
          : bank.bank_name;
        filterBank.insertAdjacentHTML(
          "beforeend",
          `<option value="${bank.bank_id}">${displayName}</option>`
        );
      });
    } catch (err) {
      console.error("Error loading banks:", err);
    }
  }

  // =========================================================
  // Fetch jobs from server
  // =========================================================
  async function loadJobData(filters = {}) {
    try {
      const params = new URLSearchParams();
      if (filters.jobCode) params.append("jobCode", filters.jobCode);
      if (filters.bankId) params.append("bankId", filters.bankId);
      if (filters.shift) params.append("shift", filters.shift);
      if (filters.startDate) params.append("startDate", filters.startDate);
      if (filters.endDate) params.append("endDate", filters.endDate);

      const res = await fetch(`/api/hi/job-management?${params.toString()}`);
      const data = await res.json();

      if (data.message === "No jobs found" || !Array.isArray(data) || data.length === 0) {
        showNoJobsMessage();
        return;
      }

      allJobs = Array.isArray(data) ? data : Object.values(data || {});
      displayJobs(allJobs);
    } catch (err) {
      console.error("Error loading jobs:", err);
      showNoJobsMessage("Error loading jobs");
    }
  }

  // =========================================================
  // Show "No Jobs" message
  // =========================================================
  function showNoJobsMessage(message = "No jobs found") {
    const msgRow = `<tr><td colspan="8" class="text-center text-muted py-3">${message}</td></tr>`;
    cardPrintingTableBody.innerHTML = msgRow;
    mailerPrintingTableBody.innerHTML = msgRow;
  }

  // =========================================================
  // Helpers
  // =========================================================
  function formatDateTime(datetime) {
    return new Date(datetime).toLocaleString();
  }

  function formatDateOnly(datetime) {
    const d = new Date(datetime);
    return d.toLocaleDateString(undefined, { year: "numeric", month: "short", day: "numeric" });
  }

  // =========================================================
  // Display jobs grouped
  // =========================================================
  function displayJobs(jobs) {
    cardPrintingTableBody.innerHTML = "";
    mailerPrintingTableBody.innerHTML = "";

    let cardIndex = 1;
    let mailerIndex = 1;

    // ✅ When filtered by date, group by date → then by jobCode+bank
    if (isFiltered && filterStartDate.value && filterEndDate.value) {
      const groupedByDate = {};

      jobs.forEach(job => {
        const allDates = new Set([
          ...job.cardPrinting.map(b => formatDateOnly(b.createdAt)),
          ...job.mailerPrinting.map(b => formatDateOnly(b.createdAt)),
        ]);

        allDates.forEach(date => {
          if (!groupedByDate[date]) groupedByDate[date] = [];
          groupedByDate[date].push(job);
        });
      });

      Object.keys(groupedByDate)
        .sort((a, b) => new Date(a) - new Date(b))
        .forEach(date => {
          // 🔹 Date header
          cardPrintingTableBody.insertAdjacentHTML("beforeend", `
            <tr class="table-info text-center fw-bold">
              <td colspan="8">${date}</td>
            </tr>
          `);
          mailerPrintingTableBody.insertAdjacentHTML("beforeend", `
            <tr class="table-info text-center fw-bold">
              <td colspan="8">${date}</td>
            </tr>
          `);

          // 🔹 Group by Job Code + Bank under this date
          groupedByDate[date].forEach(job => {
            const cardHeaderId = `card-${job.jobCode}-${job.bankName}-${date}`;
            const mailerHeaderId = `mailer-${job.jobCode}-${job.bankName}-${date}`;

            // --- Card Printing ---
            const cardBatches = job.cardPrinting.filter(
              b => formatDateOnly(b.createdAt) === date
            );
            if (cardBatches.length) {
              cardPrintingTableBody.insertAdjacentHTML("beforeend", `
                <tr class="table-primary fw-bold text-center cursor-pointer" data-toggle="${cardHeaderId}">
                  <td colspan="8">${job.jobCode} - ${job.bankName}</td>
                </tr>
              `);
              cardBatches.forEach(batch => {
                cardPrintingTableBody.insertAdjacentHTML("beforeend", `
                  <tr class="text-center" data-group="${cardHeaderId}">
                    <td>${cardIndex++}</td>
                    <td>${formatDateTime(batch.createdAt)}</td>
                    <td>${batch.shift}</td>
                    <td>${batch.operator || '-'}</td>
                    <td>${batch.device || '-'}</td>
                    <td>${batch.totalQty || 0}</td>
                    <td>${batch.completedQty || 0}</td>
                    <td>${batch.remaining || 0}</td>
                  </tr>
                `);
              });
            }

            // --- Mailer Printing ---
            const mailerBatches = job.mailerPrinting.filter(
              b => formatDateOnly(b.createdAt) === date
            );
            if (mailerBatches.length) {
              mailerPrintingTableBody.insertAdjacentHTML("beforeend", `
                <tr class="table-primary fw-bold text-center cursor-pointer" data-toggle="${mailerHeaderId}">
                  <td colspan="8">${job.jobCode} - ${job.bankName}</td>
                </tr>
              `);
              mailerBatches.forEach(batch => {
                mailerPrintingTableBody.insertAdjacentHTML("beforeend", `
                  <tr class="text-center" data-group="${mailerHeaderId}">
                    <td>${mailerIndex++}</td>
                    <td>${formatDateTime(batch.createdAt)}</td>
                    <td>${batch.shift}</td>
                    <td>${batch.operator || '-'}</td>
                    <td>${batch.device || '-'}</td>
                    <td>${batch.totalQty || 0}</td>
                    <td>${batch.completedQty || 0}</td>
                    <td>${batch.remaining || 0}</td>
                  </tr>
                `);
              });
            }
          });
        });

    } else {
      // ✅ Default: Group by Job Code + Bank (existing)
      jobs.forEach(job => {
        if (job.cardPrinting.length) {
          const cardHeaderId = `card-${job.jobCode}-${job.bankName}`;
          cardPrintingTableBody.insertAdjacentHTML("beforeend", `
            <tr class="table-primary fw-bold text-center cursor-pointer" data-toggle="${cardHeaderId}">
              <td colspan="8">${job.jobCode} - ${job.bankName}</td>
            </tr>
          `);
          job.cardPrinting.forEach(batch => {
            cardPrintingTableBody.insertAdjacentHTML("beforeend", `
              <tr class="text-center" data-group="${cardHeaderId}">
                <td>${cardIndex++}</td>
                <td>${formatDateTime(batch.createdAt)}</td>
                <td>${batch.shift}</td>
                <td>${batch.operator || '-'}</td>
                <td>${batch.device || '-'}</td>
                <td>${batch.totalQty || 0}</td>
                <td>${batch.completedQty || 0}</td>
                <td>${batch.remaining || 0}</td>
              </tr>
            `);
          });
        }

        if (job.mailerPrinting.length) {
          const mailerHeaderId = `mailer-${job.jobCode}-${job.bankName}`;
          mailerPrintingTableBody.insertAdjacentHTML("beforeend", `
            <tr class="table-primary fw-bold text-center cursor-pointer" data-toggle="${mailerHeaderId}">
              <td colspan="8">${job.jobCode} - ${job.bankName}</td>
            </tr>
          `);
          job.mailerPrinting.forEach(batch => {
            mailerPrintingTableBody.insertAdjacentHTML("beforeend", `
              <tr class="text-center" data-group="${mailerHeaderId}">
                <td>${mailerIndex++}</td>
                <td>${formatDateTime(batch.createdAt)}</td>
                <td>${batch.shift}</td>
                <td>${batch.operator || '-'}</td>
                <td>${batch.device || '-'}</td>
                <td>${batch.totalQty || 0}</td>
                <td>${batch.completedQty || 0}</td>
                <td>${batch.remaining || 0}</td>
              </tr>
            `);
          });
        }
      });
    }

    // ✅ Collapsible behavior remains the same
    document.querySelectorAll("tr.cursor-pointer").forEach(header => {
      header.addEventListener("click", () => {
        const group = header.getAttribute("data-toggle");
        document.querySelectorAll(`tr[data-group="${group}"]`).forEach(row => {
          row.style.display = row.style.display === "none" ? "" : "none";
        });
      });
    });

    document.querySelectorAll("tr[data-group]").forEach(row => row.style.display = "none");
  }

  // =========================================================
  // Apply Filters
  // =========================================================
  applyFiltersBtn.addEventListener("click", () => {
    const filters = {
      jobCode: filterJobCode.value.trim(),
      bankId: filterBank.value.trim(),
      shift: filterShift.value,
      startDate: filterStartDate.value,
      endDate: filterEndDate.value
    };
    isFiltered = !!(filters.startDate || filters.endDate);
    loadJobData(filters);
  });

  // =========================================================
  // Reset Filters
  // =========================================================
  resetFiltersBtn.addEventListener("click", () => {
    filterJobCode.value = "";
    filterBank.value = "";
    filterShift.value = "";
    filterStartDate.value = "";
    filterEndDate.value = "";
    isFiltered = false;
    loadJobData();
  });

  // =========================================================
  // Initial Load
  // =========================================================
  loadBanks();   // ✅ Load dropdown options first
  loadJobData(); // ✅ Then load job data
});







</script>
 

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
